!function(e,t,i){"use strict";var a=function(t,i){var a,o,n,s,c,r=e(t),l=e.extend(void 0,i),p=[],d=this;this.setup=function(){(new CHBSHelper).getMessageFromConsole(),d.e('select,input[type="hidden"]').each(function(){e(this)[0].hasAttribute("data-value")&&e(this).val(e(this).attr("data-value"))}),d.init()},this.init=function(){var t=new CHBSHelper;t.isMobile()&&(d.e('input[name="chbs_pickup_date_service_type_1"]').prop("readonly",!0),d.e('input[name="chbs_pickup_date_service_type_2"]').prop("readonly",!0),d.e('input[name="chbs_pickup_date_service_type_3"]').prop("readonly",!0),d.e('input[name="chbs_return_date_service_type_1"]').prop("readonly",!0),d.e('input[name="chbs_return_date_service_type_3"]').prop("readonly",!0)),d.createButtonRadio(".chbs-booking-extra"),e(window).resize(function(){try{d.e("select").selectmenu("close")}catch(e){}try{d.e(".chbs-datepicker").datepicker("hide")}catch(e){}try{d.e(".chbs-timepicker").timepicker("hide")}catch(e){}try{d.e(".ui-timepicker-wrapper").css({opacity:0})}catch(e){}try{var e=a.getCenter();google.maps.event.trigger(a,"resize"),a.setCenter(e)}catch(e){}}),d.googleMapCustomizeHeight(),e(window).on("resize",function(){d.googleMapCustomizeHeight()});var i=new URLSearchParams(window.location.search);(e(".chauffeur-destination-page").length>0||i.has("from")&&i.has("to"))&&(""!==i.get("from")&&this.createGeocodePoint(e('input[name="chbs_pickup_location_service_type_'+parseInt(d.e('[name="chbs_service_type_id"]').val())+'"]')),""!==i.get("to")&&this.createGeocodePoint(e('input[name="chbs_dropoff_location_service_type_'+parseInt(d.e('[name="chbs_service_type_id"]').val())+'"]'))),1===parseInt(l.use_my_location_link_enable,10)&&navigator.geolocation&&(d.e(".chbs-my-location-link").css("display","inline"),navigator.geolocation.getCurrentPosition(d.myLocationSuccess,d.myLocationError));var o=1,n=d.e(".chbs-tab>ul").children('li[data-id="'+parseInt(d.e('[name="chbs_service_type_id"]').val())+'"]',10);1===n.length&&(o=n.index()),d.e(".chbs-tab").tabs({activate:function(e,t){d.googleMapReInit();var i=d.getServiceTypeId();d.setServiceTypeId(i),d.googleMapCreate(),d.googleMapCreateRoute()},active:o}),d.e(".chbs-main-navigation-default a").on("click",function(t){t.preventDefault();var i=parseInt(e(this).parent("li").data("step"),10),a=parseInt(d.e('input[name="chbs_step"]').val(),10);i-a!=0&&d.goToStep(i-a)}),d.e(".chbs-main-content-step-5 .chbs-meta-icon-tick").on("click",function(e){d.goToStep(1)}),d.e(".chbs-button-step-next").on("click",function(e){e.preventDefault(),d.goToStep(1)}),d.e(".chbs-button-step-prev").on("click",function(e){e.preventDefault(),d.goToStep(-1)}),d.e(".chbs-form-field").on("click",function(t){if(t.preventDefault(),!e(t.target).hasClass("chbs-location-add")&&!e(t.target).hasClass("chbs-location-remove")){e(this).find(":input").focus();var i=e(this).find("select:not(.chbs-selectmenu-disable)");i.length&&i.selectmenu("open")}}),d.e(".chbs-location-add").on("click",function(t){t.preventDefault();var i=e(this).parent(".chbs-form-field:first"),a=d.e(".chbs-form-field-location-autocomplete.chbs-hidden").clone(!0,!0);a.insertAfter(i),a.removeClass("chbs-hidden"),a.find(":input").focus(),d.googleMapAutocompleteCreate(a.find('input[type="text"]')),d.createLabelTooltip()}),d.e(".chbs-location-remove").on("click",function(t){t.preventDefault(),e(this).parent(".chbs-form-field:first").remove(),d.googleMapCreate(),d.googleMapCreateRoute()}),d.e('.chbs-form-field-location-autocomplete input[type="text"]').each(function(){d.googleMapAutocompleteCreate(e(this))}),d.e(".chbs-payment>li>a").on("click",function(t){t.preventDefault(),e(this).parents(".chbs-payment").find("li>a").removeClass("chbs-state-selected"),e(this).addClass("chbs-state-selected"),d.getGlobalNotice().addClass("chbs-hidden"),d.e('input[name="chbs_payment_id"]').val(e(this).attr("data-payment-id"))}),d.e(">*").on("click",".chbs-form-checkbox",function(t){var i=e(this).next('input[type="hidden"]'),a=1===parseInt(i.val(),10)?0:1;1===a?e(this).addClass("chbs-state-selected"):e(this).removeClass("chbs-state-selected"),e(this).next('input[type="hidden"]').on("change",function(t){var i=1===parseInt(e(this).val(),10)?1:0,a=e(this).parents(".chbs-clear-fix:first").nextAll("div:first");0===i?a.addClass("chbs-hidden"):a.removeClass("chbs-hidden"),e(window).scroll()}),i.val(a).trigger("change")}),d.e(".chbs-main-content-step-2").on("click",".chbs-booking-extra .chbs-booking-extra-list .chbs-button.chbs-button-style-2",function(t){t.preventDefault(),void 0!==window.tsg_analytics&&window.tsg_analytics.track_event("TransferForm","Extra Button",e(this).attr("data-value-arrival")),e(this).parent(".chbs-button-radio").length||e(this).toggleClass("chbs-state-selected");var i=[];d.e(".chbs-main-content-step-2 .chbs-booking-extra-list .chbs-button.chbs-button-style-2").each(function(){e(this).hasClass("chbs-state-selected")&&i.push(e(this).attr("data-value-arrival"))}),e(this).closest("li").toggleClass("active"),d.e('input[name="chbs_booking_extra_id"]').val(i.join(","))}),d.e(".chbs-main-content-step-3").on("click",".chbs-booking-extra .chbs-booking-extra-list .chbs-button.chbs-button-style-2",function(t){t.preventDefault(),void 0!==window.tsg_analytics&&window.tsg_analytics.track_event("TransferForm","Extra Button",e(this).attr("data-value-return")),e(this).parent(".chbs-button-radio").length||e(this).toggleClass("chbs-state-selected");var i=[];d.e(".chbs-main-content-step-3 .chbs-booking-extra-list .chbs-button.chbs-button-style-2").each(function(){e(this).hasClass("chbs-state-selected")&&i.push(e(this).attr("data-value-return"))}),e(this).closest("li").toggleClass("active"),d.e('input[name="chbs_booking_extra_return_id"]').val(i.join(","))}),d.e(".chbs-main-content-step-2").on("click",".chbs-vehicle-list .chbs-button.chbs-button-style-2:not(.chbs-button-on-request)",function(t){t.preventDefault(),void 0!==window.tsg_analytics&&window.tsg_analytics.track_event("TransferForm","Vehicle Button",parseInt(e(this).parents(".chbs-vehicle").attr("data-id"),10)),d.e(".chbs-main-content-step-2 .chbs-vehicle-list .chbs-button.chbs-button-style-2").removeClass("chbs-state-selected"),e(this).addClass("chbs-state-selected"),d.e('input[name="chbs_vehicle_id"]').val(parseInt(e(this).parents(".chbs-vehicle").attr("data-id"),10)),d.e(".chbs-vehicle-content-price-bid>div").addClass("chbs-hidden"),d.e('.chbs-vehicle-list [name="chbs_vehicle_bid_price[]"]').val(""),e(this).parents(".chbs-vehicle").find(".chbs-vehicle-content-price-bid>div:first-child").removeClass("chbs-hidden"),d.getGlobalNotice().addClass("chbs-hidden")}),d.e(".chbs-main-content-step-3").on("click",".chbs-vehicle-list .chbs-button.chbs-button-style-2:not(.chbs-button-on-request)",function(t){t.preventDefault(),void 0!==window.tsg_analytics&&window.tsg_analytics.track_event("TransferForm","Vehicle Button",parseInt(e(this).parents(".chbs-vehicle").attr("data-id"),10)),d.e(".chbs-main-content-step-3 .chbs-vehicle-list .chbs-button.chbs-button-style-2").removeClass("chbs-state-selected"),e(this).addClass("chbs-state-selected"),d.e('input[name="chbs_vehicle_id_return"]').val(parseInt(e(this).parents(".chbs-vehicle").attr("data-id"),10)),d.e(".chbs-vehicle-content-price-bid>div").addClass("chbs-hidden"),d.e('.chbs-vehicle-list [name="chbs_vehicle_bid_price[]"]').val(""),e(this).parents(".chbs-vehicle").find(".chbs-vehicle-content-price-bid>div:first-child").removeClass("chbs-hidden"),d.getGlobalNotice().addClass("chbs-hidden")}),d.e(".chbs-main-content-step-2").on("click",".chbs-vehicle .chbs-vehicle-content>.chbs-vehicle-content-meta a",function(t){t.preventDefault(),e(this).toggleClass("chbs-state-selected");var i=e(this).parents(".chbs-vehicle:first").find(".chbs-vehicle-content-description"),a=parseInt(i.children("div").actual("outerHeight",{includeMargin:!0}),10);i.hasClass("chbs-state-open")?i.animate({height:0},150,function(){i.removeClass("chbs-state-open"),e(window).scroll()}):i.animate({height:a},150,function(){i.addClass("chbs-state-open"),e(window).scroll()})}),d.e(".chbs-main-content-step-4").on("click",".chbs-summary .chbs-summary-header a",function(t){t.preventDefault(),d.goToStep(parseInt(e(this).attr("data-step"),10)-4)}),d.e(".chbs-main-content-step-4").on("click",".chbs-coupon-code-section a",function(t){t.preventDefault(),d.setAction("coupon_code_check"),d.post(d.e('form[name="chbs-form"]').serialize(),function(t){d.e(".chbs-summary-price-element").replaceWith(t.html);var i=d.e(".chbs-coupon-code-section");i.qtip({show:{target:e(this)},style:{classes:1===t.error?"chbs-qtip chbs-qtip-error":"chbs-qtip chbs-qtip-success"},content:{text:t.message},position:{my:l.is_rtl?"bottom right":"bottom left",at:l.is_rtl?"top right":"top left",container:i.parent()}}).qtip("show")})}),d.e(".chbs-main-content-step-4").on("click",".chbs-gratuity-section a",function(t){t.preventDefault(),d.setAction("gratuity_customer_set"),d.post(d.e('form[name="chbs-form"]').serialize(),function(t){d.e(".chbs-summary-price-element").replaceWith(t.html);var i=d.e(".chbs-gratuity-section");i.qtip({show:{target:e(this)},style:{classes:1===t.error?"chbs-qtip chbs-qtip-error":"chbs-qtip chbs-qtip-success"},content:{text:t.message},position:{my:l.is_rtl?"bottom right":"bottom left",at:l.is_rtl?"top right":"top left",container:i.parent()}}).qtip("show"),i.find('[name="chbs_gratuity_customer_value"]').val(t.gratuity)})}),d.e(".chbs-datepicker").datepicker({autoSize:!0,minDate:l.datetime_min_format,maxDate:l.datetime_max,dateFormat:l.date_format_js,beforeShow:function(t){if(e(t).attr("name")==="chbs_return_date_service_type_"+d.getServiceTypeId())try{var i=d.e('[name="chbs_pickup_date_service_type_'+d.getServiceTypeId()+'"]').val();null!==e.datepicker.parseDate(l.date_format_js,i)&&e(this).datepicker("option","minDate",i)}catch(e){}},beforeShowDay:function(t){var i=new CHBSHelper;for(var a in t=e.datepicker.formatDate("dd-mm-yy",t),l.date_exclude){if(i.compareDate([t,l.date_exclude[a].start,l.date_exclude[a].stop]))return[!1,"",""]}var o=t.split("-"),n=(t=new Date(o[2],o[1]-1,o[0]),parseInt(t.getUTCDay(),10)+1);return l.business_hour[n].start&&l.business_hour[n].stop?[!0,"",""]:[!1,"",""]},onSelect:function(t,i){var a=new CHBSHelper,o=[i.selectedDay,i.selectedMonth+1,i.selectedYear];for(var n in o)1===new String(o[n]).length&&(o[n]="0"+o[n]);o=o[0]+"-"+o[1]+"-"+o[2];var s,c="",r="";if(a.isEmpty(c)||a.isEmpty(r)){var p=parseInt(e(this).datepicker("getDate").getUTCDay(),10)+1;"undefined"!==new String(typeof l.business_hour[p])&&(c=l.business_hour[p].start,r=l.business_hour[p].stop)}(o===(s=l.datetime_min.split(" "))[0]&&Date.parse("01/01/1970 "+s[1])>Date.parse("01/01/1970 "+c)&&(c=s[1]),a.isEmpty(l.datetime_max))||o===(s=l.datetime_max.split(" "))[0]&&Date.parse("01/01/1970 "+s[1])<Date.parse("01/01/1970 "+r)&&(r=s[1]);var h={showOn:[],showOnFocus:!1,timeFormat:l.time_format,step:l.timepicker_step,disableTouchKeyboard:!0,minTime:c,maxTime:r,disableTextInput:!1};if(1===parseInt(l.timepicker_dropdown_list_enable,10)){var _=e(this).attr("name").indexOf("pickup")>-1?"pickup":"return",u=d.e('input[name="chbs_'+_+"_time_service_type_"+d.getServiceTypeId()+'"]');try{u.timepicker("remove")}catch(e){}if(3===parseInt(d.getServiceTypeId(),10)){var g=d.e('select[name="chbs_route_service_type_3"]>option:selected'),v=JSON.parse(g.attr("data-time_exclude"));null!=v[p=parseInt(e(this).datepicker("getDate").getUTCDay(),10)+1]&&(h.step=1,h.disableTextInput=!0,h.disableTimeRanges=v[p],h.maxTime=v[p][v[p].length-2][1])}}u.timepicker(h),u.val("").timepicker("show"),u.blur(),d.setTimepicker(u)}}),e(".ui-datepicker").addClass("notranslate"),1===parseInt(l.timepicker_dropdown_list_enable,10)&&r.on("focusin",".chbs-timepicker",function(){var t=new CHBSHelper,i=e(this).attr("name").indexOf("pickup")>-1?"pickup":"return",a=d.e('input[name="chbs_'+i+"_date_service_type_"+d.getServiceTypeId()+'"]');if(t.isEmpty(a.val()))return e(this).timepicker("remove"),void a.click();t.isEmpty(e(this).val())&&e(this).timepicker("show")}),d.createSelectMenu(),d.createFixedLocationAutocomplete(),d.e(".chbs-form-field").has("select").css({cursor:"pointer"}),d.e(".chbs-main-content").on("click",".chbs-button-widget-submit",function(t){t.preventDefault();var i=new CHBSHelper,a={};if(a.service_type_id=d.getServiceTypeId(),a.pickup_date=d.e('[name="chbs_pickup_date_service_type_'+a.service_type_id+'"]').val(),a.pickup_time=d.e('[name="chbs_pickup_time_service_type_'+a.service_type_id+'"]').val(),e.inArray(d.getServiceTypeId(),[1,2])>-1){var o=d.e('[name="chbs_pickup_location_coordinate_service_type_'+a.service_type_id+'"]').val();if(!i.isEmpty(o)){var n=JSON.parse(o);a.pickup_location_lat=n.lat,a.pickup_location_lng=n.lng,a.pickup_location_address=n.address,a.pickup_location_formatted_address=n.formatted_address,a.pickup_location_text=d.e('[name="chbs_pickup_location_service_type_'+a.service_type_id+'"]').val()}o=d.e('[name="chbs_dropoff_location_coordinate_service_type_'+a.service_type_id+'"]').val();if(!i.isEmpty(o)){n=JSON.parse(o);a.dropoff_location_lat=n.lat,a.dropoff_location_lng=n.lng,a.dropoff_location_address=n.address,a.dropoff_location_formatted_address=n.formatted_address,a.dropoff_location_text=d.e('[name="chbs_dropoff_location_service_type_'+a.service_type_id+'"]').val()}var s=d.e('[name="chbs_fixed_location_pickup_service_type_'+a.service_type_id+'"]').val();parseInt(s,10)>0&&(a.fixed_location_pickup_id=s);var c=d.e('[name="chbs_fixed_location_dropoff_service_type_'+a.service_type_id+'"]').val();parseInt(c,10)>0&&(a.fixed_location_dropoff_id=c)}else a.route_id=d.e('[name="chbs_route_service_type_'+a.service_type_id+'"]').val();e.inArray(d.getServiceTypeId(),[1,3])>-1&&(a.extra_time=d.e('[name="chbs_extra_time_service_type_'+a.service_type_id+'"]').val(),a.transfer_type=d.e('[name="chbs_transfer_type_service_type_'+a.service_type_id+'"]').val(),e.inArray(a.transfer_type,[3])&&(a.duration=d.e('[name="chbs_duration_service_type_'+a.service_type_id+'"]').val(),a.return_date=d.e('[name="chbs_return_date_service_type_'+a.service_type_id+'"]').val(),a.return_time=d.e('[name="chbs_return_time_service_type_'+a.service_type_id+'"]').val())),e.inArray(d.getServiceTypeId(),[2])>-1&&(a.duration=d.e('[name="chbs_duration_service_type_'+a.service_type_id+'"]').val());var r=d.e('[name="chbs_passenger_adult_service_type_'+a.service_type_id+'"]');1===r.length&&(a.passenger_adult=r.val());var p=d.e('[name="chbs_passenger_children_service_type_'+a.service_type_id+'"]');1===p.length&&(a.passenger_children=p.val()),a.currency=d.e('[name="chbs_currency"]').val(),a.widget_submit=1;var h=l.widget.booking_form_url;-1===h.indexOf("?")&&(h+="?"),-1!==h.indexOf("&")&&(h+="&"),h+=decodeURI(e.param(a)),d.e('form[name="chbs-form"]').attr("action",h).submit()}),e(document).unbind("keydown").bind("keydown",function(t){switch(e(t.target).attr("name")){case"chbs_passenger_adult_service_type_1":case"chbs_passenger_adult_service_type_2":case"chbs_passenger_adult_service_type_3":case"chbs_passenger_children_service_type_1":case"chbs_passenger_children_service_type_2":case"chbs_passenger_children_service_type_3":if(e.inArray(parseInt(t.keyCode,10),[38,40])>-1){var i=parseInt(e(t.target).val(),10);isNaN(i)&&(i=0),38===parseInt(t.keyCode,10)?i=i+1>99?99:i+1:40===parseInt(t.keyCode,10)&&(i=i-1<0?0:i-1),e(t.target).val(parseInt(i))}}}),d.createLabelTooltip(),d.googleMapCreate(),d.googleMapInit();var c=d.e('[name="chbs_route_service_type_3"]>option:first');if(-1===parseInt(c.val(),10)&&void 0!==s){var p=[{lat:s.lat(),lng:s.lng()}];c.attr("data-coordinate",JSON.stringify(p))}d.googleMapCreateRoute(function(){1===parseInt(t.urlParam("widget_submit"),10)?d.goToStep(1,function(){r.removeClass("chbs-hidden"),e(window).scroll()}):r.removeClass("chbs-hidden"),d.googleMapStartCustomizeHeight()}),0!==r.closest(".advanced-search-wrapper-homepage").length&&r.closest(".advanced-search-wrapper-homepage").find(".gdlr-core-pbf-background.gdlr-core-parallax").css({height:r.closest(".advanced-search-wrapper-homepage").height()}),d.moveSubmitButton(),d.setDefaultPayment(),d.setBidPriceVehicle()},this.createGeocodePoint=function(e){(new google.maps.Geocoder).geocode({address:e.val()},function(t,i){if("OK"===i&&t[0]){var a=d.removeDoubleQuote(t[0].formatted_address),o={lat:t[0].geometry.location.lat(),lng:t[0].geometry.location.lng(),address:d.removeDoubleQuote(t[0].formatted_address),formatted_address:t[0].formatted_address};e.val(a),e.next("input").val(JSON.stringify(o)),d.googleMapCreate(),d.googleMapCreateRoute()}})},this.myLocationSuccess=function(e){d.e(".chbs-my-location-link").on("click",function(){var t={lat:e.coords.latitude,lng:e.coords.longitude},i=d.e('input[name="chbs_pickup_location_coordinate_service_type_1"]');i.val(JSON.stringify(t)),d.googleMapSetAddress(i,function(){d.googleMapCreate(),d.googleMapCreateRoute()},1)})},this.myLocationError=function(e){console.log(e)},this.getVehicleSelectedId=function(){return parseInt(d.e(".chbs-vehicle .chbs-vehicle-content-header .chbs-button.chbs-state-selected").parents(".chbs-vehicle").attr("data-id"),10)},this.setBidPriceVehicle=function(){d.e(".chbs-main-content-step-2"),d.e(".chbs-main-content-step-2").on("click",".chbs-vehicle-content-price-bid>div:first-child>a",function(t){t.preventDefault(),e(this).parent("div").addClass("chbs-hidden"),e(this).parent("div").next("div").removeClass("chbs-hidden")}),d.e(".chbs-main-content-step-2").on("click",".chbs-vehicle-content-price-bid>div+div>input+a",function(t){var i=e(this).prev("input");t.preventDefault(),d.setAction("vehicle_bid_price_check"),d.preloader(!0),d.post(d.e('form[name="chbs-form"]').serialize(),function(e){d.preloader(!1),void 0!==e.html&&(void 0!==e.bid_vehicle_min_value&&confirm(e.bid_question)?(i.val(e.bid_vehicle_min_value),d.preloader(!0),d.post(d.e('form[name="chbs-form"]').serialize(),function(e){d.preloader(!1),void 0!==e.html&&d.e(".chbs-summary-price-element").replaceWith(e.html)})):(d.e(".chbs-summary-price-element").replaceWith(e.html),void 0!==e.bid_notice&&alert(e.bid_notice)))})}),d.e(".chbs-main-content-step-2").on("click",".chbs-vehicle-content-price-bid>div+div>input+a+a",function(t){t.preventDefault(),e(this).parent("div").addClass("chbs-hidden"),e(this).parent("div").prev("div").removeClass("chbs-hidden"),e(this).parent("div").find('input[type="text"]').val(""),d.setAction("vehicle_bid_price_check"),d.post(d.e('form[name="chbs-form"]').serialize(),function(e){void 0!==e.html&&d.e(".chbs-summary-price-element").replaceWith(e.html)})})},this.setDefaultPayment=function(){var e=parseInt(d.e('input[name="chbs_payment_id"]').val(),10);e>0&&d.e('.chbs-payment>li>a[data-payment-id="'+e+'"]').addClass("chbs-state-selected")},this.moveSubmitButton=function(){if(r.hasClass("chbs-widget")&&r.hasClass("chbs-widget")&&r.hasClass("chbs-widget-style-2")){var e=d.e(".chbs-main-content-step-1 .chbs-button-widget-submit").parent();e.clone().appendTo(d.e("#panel-1")),e.clone().appendTo(d.e("#panel-2")),e.clone().appendTo(d.e("#panel-3")),e.remove()}},this.convertTimeToMinute=function(e){return 60*(e=e.split(":"))[0]+e[1]},this.createLabelTooltip=function(){d.e(".chbs-tooltip").qtip({style:{classes:"chbs-qtip chbs-qtip-success"},position:{my:"bottom left",at:"top left",container:r}})},this.setTimepicker=function(t){1===parseInt(l.timepicker_dropdown_list_enable,10)&&e(".ui-timepicker-wrapper").css({opacity:1,width:t.parent("div").outerWidth()+1})},this.createSelectMenu=function(){d.e("select:not(.chbs-selectmenu-disable)").selectmenu({open:function(t,i){var a=e(this),o=e("#"+a.attr("id")+"-menu").parent("div"),n=a.parents(".chbs-form-field:first"),s=parseInt(o.css("left"),10)-1,c=parseInt(n.css("border-left-width"),10)+parseInt(n.css("border-right-width"),10),r=n[0].getBoundingClientRect().width-c;o.css({width:r+2,left:s})},change:function(t,i){var a=e(this).attr("name");if("chbs_route_service_type_3"===a&&(d.googleMapCreate(),d.googleMapCreateRoute()),e.inArray(a,["chbs_transfer_type_service_type_1","chbs_transfer_type_service_type_3"])>-1){var o=d.e('[name="chbs_return_date_service_type_'+d.getServiceTypeId()+'"]').parent("div").parent("div");3===parseInt(e(this).val(),10)?o.removeClass("chbs-hidden"):o.addClass("chbs-hidden")}if(e.inArray(a,["chbs_extra_time_service_type_1","chbs_transfer_type_service_type_1","chbs_duration_service_type_2","chbs_extra_time_service_type_3","chbs_transfer_type_service_type_3"])>-1&&d.reCalculateRoute(),"chbs_navigation_responsive"===a){var n=parseInt(e(this).val(),10),s=parseInt(d.e('input[name="chbs_step"]').val(),10);if(n-s==0)return;d.goToStep(n-s)}e.inArray(a,["chbs_vehicle_passenger_count","chbs_vehicle_bag_count","chbs_vehicle_standard","chbs_vehicle_category"])>-1&&(d.setAction("vehicle_filter"),d.e(".chbs-vehicle-list").children().addClass("chbs-hidden"),d.e(".chbs-vehicle-list").addClass("chbs-preloader-1"),d.post(d.e('form[name="chbs-form"]').serialize(),function(e){d.getGlobalNotice().addClass("chbs-hidden");var t=d.e(".chbs-vehicle-list");t.html("").removeClass("chbs-preloader-1"),void 0!==e.error&&void 0!==e.error.global?d.getGlobalNotice().removeClass("chbs-hidden").html(e.error.global[0].message):(t.html(e.html),d.recalculateVehiclePrice(e,1)),d.e(".chbs-vehicle-list").find(".chbs-button.chbs-button-style-2").removeClass("chbs-state-selected"),d.preloadVehicleImage(),d.e('input[name="chbs_vehicle_id"]').val(0),d.createSummaryElement()})),e.inArray(a,["chbs_fixed_location_pickup_service_type_1","chbs_fixed_location_dropoff_service_type_1","chbs_fixed_location_pickup_service_type_2","chbs_fixed_location_dropoff_service_type_3"]>-1)&&d.googleMapSetAddress(e(this),function(){d.googleMapCreate(),d.googleMapCreateRoute()}),e.inArray(a,["chbs_fixed_location_pickup_service_type_1","chbs_fixed_location_pickup_service_type_2"]>-1)&&d.checkFixedLocationPickup(a),e.inArray(a,["chbs_fixed_location_dropoff_service_type_1"]>-1)&&d.checkFixedLocationPickup("chbs_fixed_location_pickup_service_type_1"),e.inArray(a,["chbs_fixed_location_dropoff_service_type_2"]>-1)&&d.checkFixedLocationPickup("chbs_fixed_location_pickup_service_type_2")}}),d.e(".ui-selectmenu-button .ui-icon.ui-icon-triangle-1-s").attr("class","chbs-meta-icon-arrow-vertical-large"),d.checkFixedLocationPickup("chbs_fixed_location_pickup_service_type_1"),d.checkFixedLocationPickup("chbs_fixed_location_pickup_service_type_2");var t=[1,3];for(var i in t){var a=d.e('[name="chbs_transfer_type_service_type_'+t[i]+'"]');if(1===a.length)if(3===parseInt(a.val(),10))d.e('[name="chbs_return_date_service_type_'+t[i]+'"]').parents(".chbs-form-field").parent(".chbs-clear-fix").removeClass("chbs-hidden")}},this.getFixedLocationSource=function(t){var i=[];return e(t).next("select").find('option:not([disabled="disabled"])').each(function(e,t){i.push({label:t.text,value:t.value})}),i},this.createFixedLocationAutocomplete=function(){d.e(".chbs-form-field-location-fixed-autocomplete").each(function(t,i){var a=d.getFixedLocationSource(i);a.length&&(e(i).autocomplete({source:a,minLength:0,focus:function(e,t){e.preventDefault()},select:d.handleFixedLocationAutocompleteChange,change:d.handleFixedLocationAutocompleteChange}).focus(function(){e(this).autocomplete("search")}),e.ui.autocomplete.filter=function(t,i){var a=new RegExp("^"+e.ui.autocomplete.escapeRegex(i),"i");return e.grep(t,function(e){return a.test(e.label||e.value||e)})})})},this.handleFixedLocationAutocompleteChange=function(t,i){t.preventDefault();var a=e(t.target).next("select"),o=a.attr("name");null==i.item?(e(t.target).val(""),a.val("")):(e(t.target).val(i.item.label),a.val(i.item.value)),e.inArray(o,["chbs_fixed_location_pickup_service_type_1","chbs_fixed_location_dropoff_service_type_1","chbs_fixed_location_pickup_service_type_2","chbs_fixed_location_dropoff_service_type_3"]>-1)&&d.googleMapSetAddress(a,function(){d.googleMapCreate(),d.googleMapCreateRoute()}),e.inArray(o,["chbs_fixed_location_pickup_service_type_1","chbs_fixed_location_pickup_service_type_2"]>-1)&&d.checkFixedLocationPickup(o),e.inArray(o,["chbs_fixed_location_dropoff_service_type_1"]>-1)&&d.checkFixedLocationPickup("chbs_fixed_location_pickup_service_type_1"),e.inArray(o,["chbs_fixed_location_dropoff_service_type_2"]>-1)&&d.checkFixedLocationPickup("chbs_fixed_location_pickup_service_type_2")},this.checkFixedLocationPickup=function(t){var i=t.replace("pickup","dropoff"),a=d.e('[name="'+i+'"]');a.children("option").removeAttr("disabled");try{a.selectmenu("refresh")}catch(e){}var o=d.e('select[name="'+t+'"]').children("option:selected").attr("data-location");if(void 0!==o&&(o=JSON.parse(o)).dropoff_disable.length){for(var n in o.dropoff_disable)a.children('option[value="'+o.dropoff_disable[n]+'"]').attr("disabled","disabled").removeAttr("selected");try{a.selectmenu("refresh")}catch(e){}d.e(".chbs-form-field-location-fixed-autocomplete").each(function(t,i){var a=d.getFixedLocationSource(i);e(i).autocomplete({source:a})})}},this.getServiceTypeId=function(){return parseInt(d.e(".ui-tabs .ui-tabs-active").attr("data-id"),10)},this.setServiceTypeId=function(e){d.e('input[name="chbs_service_type_id"]').val(e)},this.setAction=function(e){d.e('input[name="action"]').val("chbs_"+e)},this.e=function(e){return r.find(e)},this.recalculateVehiclePrice=function(t,i){if(1===parseInt(t.booking_summary_hide_fee,10)&&1===parseInt(i,10)){var a=[];if(d.e(".chbs-vehicle-list>ul>li").each(function(){var t=new CHBSHelper,i=e(this).children("div:first");t.isEmpty(i.attr("data-base_location_cooridnate_lat"))||t.isEmpty(i.attr("data-base_location_cooridnate_lng"))||a.push({id:i.attr("data-id"),lat:i.attr("data-base_location_cooridnate_lat"),lng:i.attr("data-base_location_cooridnate_lng")})}),a.length){d.e(".chbs-vehicle-list").children().addClass("chbs-hidden"),d.e(".chbs-vehicle-list").addClass("chbs-preloader-1");var o=0;for(var n in a)d.calculateBaseLocationDistance(function(e){o++;var t=d.e('.chbs-vehicle-list .chbs-vehicle[data-id="'+e.id+'"]');t.find('[name="chbs_base_location_vehicle_distance['+e.id+']"]').val(e.distance),t.find('[name="chbs_base_location_vehicle_return_distance['+e.id+']"]').val(e.return_distance),o!==a.length||d.goToStep(0)},a[n])}}},this.goToStep=function(t,i){d.preloader(!0),d.setAction("go_to_step");var o=d.e('input[name="chbs_step"]'),n=d.e('input[name="chbs_step_request"]');void 0!==window.tsg_analytics&&window.tsg_analytics.track_event("TransferForm",t>0?"Next Button":"Previous Button",parseInt(n.val(),10));var s=parseInt(o.val(),10)+t;n.val(s),d.setServiceTypeId(d.getServiceTypeId());var c=d.getServiceTypeId();if(2===parseInt(n.val(),10)){var r=parseInt(d.e('[name="chbs_passenger_adult_service_type_'+c+'"]').val(),10)+parseInt(d.e('[name="chbs_passenger_children_service_type_'+c+'"]').val(),10);r>0&&d.e('[name="chbs_vehicle_passenger_count"]').val(r)}var p=new CHBSHelper,h={};h.service_type_id=d.getServiceTypeId();var _=d.e('[name="chbs_pickup_location_coordinate_service_type_'+h.service_type_id+'"]').val();if(!p.isEmpty(_)){var u=JSON.parse(_);h.pickup_location_formatted_address=u.formatted_address,void 0!==window.tsg_analytics&&window.tsg_analytics.track_search(h.pickup_location_formatted_address,"From",1)}_=d.e('[name="chbs_dropoff_location_coordinate_service_type_'+h.service_type_id+'"]').val();if(!p.isEmpty(_)){u=JSON.parse(_);h.pickup_location_formatted_address=u.formatted_address,void 0!==window.tsg_analytics&&window.tsg_analytics.track_search(h.pickup_location_formatted_address,"To",1)}d.post(d.e('form[name="chbs-form"]').serialize(),function(t){var o=d.e('input[name="chbs_step"]').val();switch(t.step=parseInt(t.step,10),d.getGlobalNotice().addClass("chbs-hidden"),5!==parseInt(t.step,10)&&(d.e(".chbs-main-content>div").css("display","none"),d.e(".chbs-main-content>div:eq("+(t.step-1)+")").css("display","block")),d.e('input[name="chbs_step"]').val(t.step),google.maps.event.trigger(a,"resize"),d.e('select[name="chbs_navigation_responsive"]').val(t.step),d.e('select[name="chbs_navigation_responsive"]').selectmenu("refresh"),1===parseInt(t.step,10)?d.googleMapStartCustomizeHeight():d.googleMapStopCustomizeHeight(),parseInt(t.step,10)){case 1:e(".chbs-main-content-step-1 .chbs-summary").remove(),e(".chbs-main-content-step-1 .chbs-summary-price-element").remove(),d.googleMapCustomizeHeight();break;case 2:var n=d.e('input[name="chbs_vehicle_id"]');d.e(".chbs-main-content-step-2 .chbs-booking-route-title-wrapper").html(t.route_info),d.e(".chbs-main-content-step-2 .chbs-vehicle-filter>.chbs-form-field:first>div").html(t.vehicle_passenger_filter_field),void 0!==t.vehicle&&(d.e(".chbs-main-content-step-2 .chbs-vehicle-list").removeClass("chbs-preloader-1"),d.e(".chbs-main-content-step-2 .chbs-vehicle-list").html(t.vehicle),d.recalculateVehiclePrice(t,o)),void 0!==t.booking_extra&&d.e(".chbs-main-content-step-2 .chbs-booking-extra").html(t.booking_extra);var s=d.e('[name="chbs_transfer_type_service_type_'+h.service_type_id+'"]').val();if(d.e(".chbs-main-content-step-2 > .chbs-main-content-navigation-button .chbs-button-step-next").hide(),d.e(".chbs-main-content-step-2 > .chbs-main-content-navigation-button .chbs-button-step-next.next_"+s).show(),void 0!==t.booking_extra&&d.e(".chbs-main-content-step-2 .chbs-booking-extra").html(t.booking_extra),"-1"==n.val()){var c=0,r=0;e(".chbs-main-content-step-2 .chbs-vehicle-list > .chbs-list-reset > li").each(function(){var t=e(this).find(".chbs-vehicle-content-price").text(),i=e(this).index();t=t.replace("$",""),t=parseInt(t.split(".")[0]),(0===c||c>=t)&&(c=t,r=i)}),e(".chbs-main-content-step-2 .chbs-vehicle-list > .chbs-list-reset > li").eq(r).find(".chbs-vehicle-content-header .chbs-button").trigger("click")}else{var p=n.val();0!==e('.chbs-main-content-step-2 .chbs-vehicle-list .chbs-vehicle[data-id="'+p+'"] .chbs-button').length?(e(".chbs-main-content-step-2 .chbs-vehicle-list .chbs-button.chbs-state-selected").removeClass("chbs-state-selected"),e('.chbs-main-content-step-2 .chbs-vehicle-list .chbs-vehicle[data-id="'+p+'"] .chbs-button').addClass("chbs-state-selected")):e(".chbs-main-content-step-2 .chbs-vehicle-list > .chbs-list-reset > li").eq(0).find(".chbs-vehicle-content-header .chbs-button").trigger("click")}0!==e(".chbs-booking-extra-category-list").length&&e(".chbs-booking-extra-category-list > div:first-child > a").trigger("click"),d.preloadVehicleImage(),d.createVehicleGallery(),d.createSelectMenu(),d.createFixedLocationAutocomplete(),d.manageBookingExtra(".chbs-main-content-step-2");break;case 3:n=d.e('input[name="chbs_vehicle_id_return"]');if(d.e(".chbs-main-content-step-3 .chbs-booking-route-title-wrapper").html(t.route_info),d.e(".chbs-main-content-step-3 .chbs-vehicle-filter>.chbs-form-field:first>div").html(t.vehicle_passenger_filter_field),void 0!==t.vehicle&&(d.e(".chbs-main-content-step-3 .chbs-vehicle-list").removeClass("chbs-preloader-1"),d.e(".chbs-main-content-step-3 .chbs-vehicle-list").html(t.vehicle),d.recalculateVehiclePrice(t,o)),void 0!==t.booking_extra&&d.e(".chbs-main-content-step-3 .chbs-booking-extra").html(t.booking_extra),"-1"==n.val()){c=0,r=0;e(".chbs-main-content-step-3 .chbs-vehicle-list > .chbs-list-reset > li").each(function(){var t=e(this).find(".chbs-vehicle-content-price").text(),i=e(this).index();t=t.replace("$",""),t=parseInt(t.split(".")[0]),(0===c||c>=t)&&(c=t,r=i)}),e(".chbs-main-content-step-3 .chbs-vehicle-list > .chbs-list-reset > li").eq(r).find(".chbs-vehicle-content-header .chbs-button").trigger("click")}else{p=n.val();e(".chbs-main-content-step-3 .chbs-vehicle-list .chbs-button.chbs-state-selected").removeClass("chbs-state-selected"),e('.chbs-main-content-step-3 .chbs-vehicle-list .chbs-vehicle[data-id="'+p+'"] .chbs-button').addClass("chbs-state-selected")}d.preloadVehicleImage(),d.createVehicleGallery(),d.createSelectMenu(),d.createFixedLocationAutocomplete(),d.manageBookingExtra(".chbs-main-content-step-3");break;case 4:void 0!==t.summary&&d.e(".chbs-main-content-step-4>.chbs-layout-25x75 .chbs-layout-column-left:first").html(t.summary[0]),void 0!==t.booking_information&&d.e(".chbs-main-content-step-4 .chbs-client-form").html(t.booking_information)}if(d.createLabelTooltip(),e(window).scroll(),e(".qtip").remove(),void 0!==t.error&&(void 0!==t.error.global[0]&&d.getGlobalNotice().removeClass("chbs-hidden").html(t.error.global[0].message),void 0!==t.error.local))for(var _ in t.error.local){var u,g,v=t.error.local[_].field.split("-");u=isNaN(v[1])?'[name="'+v[0]+'"]:eq(0)':'[name="'+v[0]+'[]"]:eq('+v[1]+")",(g=d.e(u).prevAll("label")).qtip({show:{target:e(this)},style:{classes:1===t.error?"chbs-qtip chbs-qtip-error":"chbs-qtip chbs-qtip-success"},content:{text:t.error.local[_].message},position:{my:l.rtl_mode?"bottom right":"bottom left",at:l.rtl_mode?"top right":"top left",container:g.parents('[name="chbs-form"]')}}).qtip("show")}5===parseInt(t.step,10)&&(d.e(".chbs-main-navigation-default").addClass("chbs-hidden"),d.e(".chbs-main-navigation-responsive").addClass("chbs-hidden"),1!==parseInt(t.cart_url,10)&&(window.location.href=t.cart_url));1===e("#wpadminbar").length&&e("#wpadminbar").height(),void 0!==i&&i(),5!==parseInt(t.step,10)&&d.preloader(!1)})},this.manageBookingExtra=function(e){var t=d.e(e+" .chbs-booking-extra-list");if(1===t.length){var i;if(".chbs-main-content-step-2"===e){i=(i=d.e('input[name="chbs_booking_extra_id"]').val()).split(",");for(var a=0;a<i.length;a++)t.find('.chbs-button.chbs-button-style-2[data-value-arrival="'+i[a]+'"]').addClass("chbs-state-selected").closest("li").addClass("active")}else if(".chbs-main-content-step-3"===e){i=(i=d.e('input[name="chbs_booking_extra_return_id"]').val()).split(",");for(a=0;a<i.length;a++)t.find('.chbs-button.chbs-button-style-2[data-value-return="'+i[a]+'"]').addClass("chbs-state-selected").closest("li").addClass("active")}d.createSummaryElement()}},this.post=function(t,i){e.post(l.ajax_url,t,function(e){i(e)},"json")},this.preloader=function(e){d.e("#chbs-preloader").css("display",e?"block":"none")},this.preloadVehicleImage=function(){d.e(".chbs-vehicle-list .chbs-vehicle-image img").one("load",function(){e(this).parent(".chbs-vehicle-image").animate({opacity:1},300)}).each(function(){this.complete&&e(this).load()})},this.createVehicleGallery=function(){d.e(".chbs-main-content-step-2").on("click",".chbs-vehicle-list .chbs-vehicle-image img",function(t){t.preventDefault();var i=e(this).parents(".chbs-vehicle-image:first").nextAll(".chbs-vehicle-gallery");1===parseInt(i.length,10)&&e.fancybox.open(i.find("img"))})},this.googleMapStartCustomizeHeight=function(){1!==parseInt(l.widget.mode,10)&&(c>0||(c=window.setInterval(function(){d.googleMapCustomizeHeight()},500)))},this.googleMapStopCustomizeHeight=function(){1!==parseInt(l.widget.mode,10)&&(clearInterval(c),d.e("#chbs_google_map").height("420px"),c=0)},this.googleMapCustomizeHeight=function(){if(1!==parseInt(l.widget.mode,10)){var t=d.e(".chbs-ride-info"),i=d.e(".chbs-main-content-step-1>.chbs-layout-50x50>.chbs-layout-column-left"),o=e(window).width()<768?420:parseInt(i.actual("height"),10)-parseInt(t.actual("height"),10);d.e("#chbs_google_map").height(o),google.maps.event.trigger(a,"resize")}},this.googleMapAutocompleteCreate=function(t){if(!t.is("[readonly]")){var i="chbs_location_"+(new CHBSHelper).getRandomString(16);t.attr("id",i).on("keypress",function(e){if(13===e.which)return e.preventDefault(),!1}),t.on("change",function(){e.trim(e(this).val()).length||(t.siblings('input[type="hidden"]').val(""),d.googleMapCreate(),d.googleMapCreateRoute())});var a={},o=new CHBSHelper,n=new String(t.attr("name"));if(n.indexOf("pickup")>-1&&1===parseInt(l.driving_zone.pickup.enable)){if(!o.isEmpty(l.driving_zone.pickup.area.coordinate.lat)&&!o.isEmpty(l.driving_zone.pickup.area.coordinate.lat)&&parseInt(l.driving_zone.pickup.area.radius,10)>=0){var s=new google.maps.Circle({center:new google.maps.LatLng(l.driving_zone.pickup.area.coordinate.lat,l.driving_zone.pickup.area.coordinate.lng),radius:1e3*l.driving_zone.pickup.area.radius});a.strictBounds=!0,a.bounds=s.getBounds()}l.driving_zone.pickup.country.length&&-1===e.inArray(-1,l.driving_zone.pickup.country)&&(a.componentRestrictions={},a.componentRestrictions.country=l.driving_zone.pickup.country)}if(n.indexOf("dropoff")>-1&&1===parseInt(l.driving_zone.dropoff.enable,10)){if(!o.isEmpty(l.driving_zone.dropoff.area.coordinate.lat)&&!o.isEmpty(l.driving_zone.dropoff.area.coordinate.lat)&&parseInt(l.driving_zone.dropoff.area.radius,10)>=0){s=new google.maps.Circle({center:new google.maps.LatLng(l.driving_zone.dropoff.area.coordinate.lat,l.driving_zone.dropoff.area.coordinate.lng),radius:1e3*l.driving_zone.dropoff.area.radius});a.strictBounds=!0,a.bounds=s.getBounds()}l.driving_zone.dropoff.country.length&&-1===e.inArray(-1,l.driving_zone.dropoff.country)&&(a.componentRestrictions={},a.componentRestrictions.country=l.driving_zone.dropoff.country)}var c=new google.maps.places.Autocomplete(document.getElementById(i),a);c.addListener("place_changed",function(e){var i=c.getPlace();if(!i.geometry)return alert(l.message.place_geometry_error),t.val(""),!1;var a={lat:i.geometry.location.lat(),lng:i.geometry.location.lng(),formatted_address:d.removeDoubleQuote(t.val())},o=t.siblings('input[type="hidden"]');o.val(JSON.stringify(a)),d.googleMapSetAddress(o,function(){d.googleMapCreate(),d.googleMapCreateRoute()})})}},this.googleMapInit=function(){d.googleMapExist()&&(1===parseInt(l.gooogle_map_option.default_location.type,10)&&navigator.geolocation?(d.googleMapSetDefaultLocation(),navigator.geolocation.getCurrentPosition(function(e){s=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),a.setCenter(s)},function(){d.googleMapSetDefaultLocation()})):d.googleMapSetDefaultLocation())},this.googleMapSetDefaultLocation=function(){if(void 0===s&&(s=new google.maps.LatLng(l.gooogle_map_option.default_location.coordinate.lat,l.gooogle_map_option.default_location.coordinate.lng)),3!==d.getServiceTypeId()){var e=new CHBSHelper,t=[];t[0]=d.e('[name="chbs_pickup_location_coordinate_service_type_'+d.getServiceTypeId()+'"]').val(),t[1]=d.e('[name="chbs_dropoff_location_coordinate_service_type_'+d.getServiceTypeId()+'"]').val(),e.isEmpty(t[0])||e.isEmpty(t[1])||(s=new google.maps.LatLng(t[0],t[1])),a.setCenter(s)}},this.googleMapCreate=function(){if(1===d.e("#chbs_google_map").length){o=new google.maps.DirectionsRenderer,n=new google.maps.DirectionsService;var t={draggable:l.gooogle_map_option.draggable.enable,scrollwheel:l.gooogle_map_option.scrollwheel.enable,mapTypeId:google.maps.MapTypeId[l.gooogle_map_option.map_control.id],mapTypeControl:l.gooogle_map_option.map_control.enable,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle[l.gooogle_map_option.map_control.style],position:google.maps.ControlPosition[l.gooogle_map_option.map_control.position]},zoom:l.gooogle_map_option.zoom_control.level,zoomControl:l.gooogle_map_option.zoom_control.enable,zoomControlOptions:{position:google.maps.ControlPosition[l.gooogle_map_option.zoom_control.position]},streetViewControl:!1};if(a=new google.maps.Map(d.e("#chbs_google_map")[0],t),1===parseInt(l.gooogle_map_option.traffic_layer.enable,10))(new google.maps.TrafficLayer).setMap(a);o.setMap(a),d.googleMapDraggableLocationAllowed()?o.setOptions({draggable:!0,suppressMarkers:!1}):o.setOptions({draggable:!1,suppressMarkers:!0}),d.googleMapDraggableLocationAllowed()&&(a.addListener("click",function(e){var t=new CHBSHelper,i=d.e('[name="chbs_pickup_location_service_type_'+d.getServiceTypeId()+'"]'),a=i.siblings('input[type="hidden"]'),o=d.e('[name="chbs_dropoff_location_service_type_'+d.getServiceTypeId()+'"]'),n=o.siblings('input[type="hidden"]');(t.isEmpty(a.val())||t.isEmpty(n.val()))&&(new google.maps.Geocoder).geocode({location:e.latLng},function(s,c){if("OK"===c&&s[0]){var r=d.removeDoubleQuote(s[0].formatted_address),l={lat:e.latLng.lat(),lng:e.latLng.lng(),address:d.removeDoubleQuote(s[0].formatted_address),formatted_address:s[0].formatted_address};t.isEmpty(a.val())?(i.val(r),a.val(JSON.stringify(l))):t.isEmpty(n.val())&&(o.val(r),n.val(JSON.stringify(l))),d.googleMapCreate(),d.googleMapCreateRoute()}})}),o.addListener("directions_changed",function(){var t=new CHBSHelper,i=new google.maps.Geocoder,a=o.getDirections().routes[0],n=[];a.legs.forEach(function(e,t){0===parseInt(t,10)&&n.push({lat:e.start_location.lat(),lng:e.start_location.lng()}),e.via_waypoints.forEach(function(e,t){n.push({lat:e.lat(),lng:e.lng()})}),n.push({lat:e.end_location.lat(),lng:e.end_location.lng()})});var s=n.length,c=d.e('[name="chbs_waypoint_location_service_type_'+d.getServiceTypeId()+'[]"]'),r=[];r.push(d.e('[name="chbs_pickup_location_service_type_'+d.getServiceTypeId()+'"]')),d.e('[name="chbs_waypoint_location_service_type_'+d.getServiceTypeId()+'[]"]').each(function(t,i){t>0&&r.push(e(i))}),r.push(d.e('[name="chbs_dropoff_location_service_type_'+d.getServiceTypeId()+'"]'));var l=r.length;if(s>l){for(var p,h=1;h<s-1;h++)if(p=!1,c.each(function(i,a){if(i>0){var o=e(a).siblings('input[type="hidden"]').val();if(!t.isEmpty(o)){var s=JSON.parse(o);if(s.lat==n[h].lat&&s.lng==n[h].lng)return p=!0,!1}}}),!p){var _=h;i.geocode({location:new google.maps.LatLng(n[_].lat,n[_].lng)},function(e,t){if("OK"===t&&e[0]){var i=d.removeDoubleQuote(e[0].formatted_address),a={lat:e[0].geometry.location.lat(),lng:e[0].geometry.location.lng(),address:d.removeDoubleQuote(e[0].formatted_address),formatted_address:e[0].formatted_address};d.e(".chbs-location-add").eq(_).trigger("click");var o=d.e('[name="chbs_waypoint_location_service_type_'+d.getServiceTypeId()+'[]"]').eq(_),n=o.siblings('input[type="hidden"]');o.val(i),n.val(JSON.stringify(a)),d.googleMapCreate(),d.googleMapCreateRoute()}})}}else{var u=!1,g=0;if(r.forEach(function(e,t){var i=new CHBSHelper,a=e.siblings('input[type="hidden"]').val();if(!i.isEmpty(a)||2!==l||1!==t||n[0].lat==n[1].lat&&n[0].lng==n[1].lng)i.isEmpty(a)||((a=JSON.parse(a)).lat==n[g].lat&&a.lng==n[g].lng||(u=e,a.lat=n[g].lat,a.lng=n[g].lng,e.siblings('input[type="hidden"]').val(JSON.stringify(a))),g++);else{u=e;var o={lat:n[1].lat,lng:n[1].lng};e.siblings('input[type="hidden"]').val(JSON.stringify(o))}}),0!=u){var v=JSON.parse(u.siblings('input[type="hidden"]').val());i.geocode({location:new google.maps.LatLng(v.lat,v.lng)},function(e,t){if("OK"===t&&e[0]){var i=d.removeDoubleQuote(e[0].formatted_address);u.val(i),v.formatted_address=i,u.siblings('input[type="hidden"]').val(JSON.stringify(v))}}),d.googleMapCreate(),d.googleMapCreateRoute()}}}))}},this.getCoordinate=function(){var t=new CHBSHelper,i=new Array,a=d.getServiceTypeId(),o=d.e("#panel-"+a).children(".chbs-form-field-location-autocomplete,.chbs-form-field-location-fixed");if(1===a||2===a)o.each(function(){if(2===a&&e(this).hasClass("chbs-form-field-location-autocomplete")&&1===e(this).children('input[name="chbs_dropoff_location_service_type_2"]').length)return!0;var o;try{o=e(this).hasClass("chbs-form-field-location-autocomplete")?JSON.parse(e(this).children('input[type="hidden"]').val()):0===e(this).find("input.chbs-form-field-location-fixed-autocomplete").length||e(this).find("input.chbs-form-field-location-fixed-autocomplete").val().length?JSON.parse(e(this).find("select>option:selected").attr("data-location")):{lat:"",lng:""}}catch(e){o={lat:"",lng:""}}t.isEmpty(o.lat)||t.isEmpty(o.lng)||i.push(new google.maps.LatLng(o.lat,o.lng))});else{var n=d.e('select[name="chbs_route_service_type_3"]>option:selected');if(1===n.length){var s=JSON.parse(n.attr("data-coordinate"));for(var c in s)t.isEmpty(s[c].lat)||t.isEmpty(s[c].lng)||i.push(new google.maps.LatLng(s[c].lat,s[c].lng))}}return i},this.googleMapExist=function(){return void 0!==a},this.googleMapDraggableLocationAllowed=function(){},this.googleMapCreateRoute=function(t){var i=d.getServiceTypeId();if(d.googleMapExist()){var s,c=d.e("#panel-"+i).children(".chbs-form-field-location-autocomplete"),r=d.getCoordinate(),p=r.length;if(0===p)return d.googleMapReInit(),void(void 0!==t&&t());if(2===i&&2===p&&(r=[r[0]],p=1),p>2){var h=new Array;r.forEach(function(e,t){t>0&&t<p-1&&h.push({location:e,stopover:!0})}),s={origin:r[0],waypoints:h,optimizeWaypoints:!0,destination:r[p-1],travelMode:google.maps.DirectionsTravelMode.DRIVING}}else s=2===p?{origin:r[0],destination:r[p-1],travelMode:google.maps.DirectionsTravelMode.DRIVING}:{origin:r[p-1],destination:r[p-1],travelMode:google.maps.DirectionsTravelMode.DRIVING};s.avoidTolls=e.inArray("tolls",l.gooogle_map_option.route_avoid)>-1,s.avoidFerries=e.inArray("ferries",l.gooogle_map_option.route_avoid)>-1,s.avoidHighways=e.inArray("highways",l.gooogle_map_option.route_avoid)>-1,n.route(s,function(n,s){if(d.googleMapClearMarker(),s===google.maps.DirectionsStatus.OK){if(d.googleMapDraggableLocationAllowed()){var r=new CHBSHelper,p=n.routes[0],h=[];p.legs.forEach(function(e,t){0===t&&h.push({lat:e.start_location.lat(),lng:e.start_location.lng()}),e.via_waypoints.forEach(function(e,t){h.push({lat:e.lat(),lng:e.lng()})}),h.push({lat:e.end_location.lat(),lng:e.end_location.lng()})});var _=[];_.push(d.e('[name="chbs_pickup_location_service_type_'+d.getServiceTypeId()+'"]')),d.e('[name="chbs_waypoint_location_service_type_'+d.getServiceTypeId()+'[]"]').each(function(t,i){t>0&&_.push(e(i))}),_.push(d.e('[name="chbs_dropoff_location_service_type_'+d.getServiceTypeId()+'"]'));var u=0;_.forEach(function(e,t){var i=e.siblings('input[type="hidden"]').val();r.isEmpty(i)||((i=JSON.parse(i)).lat=h[u].lat,i.lng=h[u].lng,e.siblings('input[type="hidden"]').val(JSON.stringify(i)),u++)})}for(var g in o.setDirections(n),n,n.routes[0].legs){var v=n.routes[0].legs[g];d.googleMapCreateMarker(v.start_location),d.googleMapCreateMarker(v.end_location)}a.setCenter(o.getDirections().routes[0].bounds.getCenter()),d.calculateRoute(n)}else s===google.maps.DirectionsStatus.ZERO_RESULTS&&1===i&&(alert(l.message.designate_route_error),c.each(function(){e(this).children('input[type="text"]').val(""),e(this).children('input[type="hidden"]').val("")}),d.googleMapReInit());void 0!==t&&t()})}else void 0!==t&&t()},this.googleMapClearMarker=function(){for(var e in p)p[e].setMap(null);p=[]},this.googleMapCreateMarker=function(e){if(!d.googleMapDraggableLocationAllowed()){for(var t in p)if(p[t].position.lat()==e.lat()&&p[t].position.lng()==e.lng())return;var i=p.length+1,o=new google.maps.Marker({position:e,map:a,label:""+i});p.push(o)}},this.googleMapReInit=function(){d.googleMapExist()&&(o=new google.maps.DirectionsRenderer,n=new google.maps.DirectionsService,null,o.setDirections({routes:[]}),a.setZoom(l.gooogle_map_option.zoom_control.level),d.calculateRoute(),null!==s&&a.setCenter(s))},this.googleMapSetAddress=function(e,t,i=-1){var a,o=new CHBSHelper;"select"!==e.prop("tagName").toLowerCase()?(a=JSON.parse(e.val()),-1===i&&(i=parseInt(l.google_autosugestion_address_type,10)),o.isEmpty(a.lat)||o.isEmpty(a.lng)||(new google.maps.Geocoder).geocode({location:new google.maps.LatLng(a.lat,a.lng)},function(n,s){if("OK"===s&&n[0]){if(a.address=d.removeDoubleQuote(n[0].formatted_address),o.isEmpty(a.formatted_address)&&(a.formatted_address=n[0].formatted_address),1===i){var c=e.parent(".chbs-form-field-location-autocomplete").children('input[type="text"]');1===c.length&&c.val(a.address)}e.val(JSON.stringify(a)),t()}})):t()},this.calculateRoute=function(e){var t=0,i=0;if(void 0!==e&&void 0!==e.routes)for(var a=0;a<e.routes[0].legs.length;a++)t+=e.routes[0].legs[a].distance.value,i+=e.routes[0].legs[a].duration.value;t/=1e3,i=Math.ceil(i/60),d.e('input[name="chbs_distance_map"]').val(Math.round(10*t)/10),d.e('input[name="chbs_duration_map"]').val(i*l.ride_time_multiplier),d.reCalculateRoute()},this.reCalculateRoute=function(){var t=0,i=0,a=parseInt(d.e('input[name="chbs_service_type_id"]').val(),10);switch(i=d.e('input[name="chbs_distance_map"]').val(),a){case 1:t=d.e('select[name="chbs_extra_time_service_type_1"]').val(),isNaN(t)&&(t=0),t*=2===l.extra_time_unit?60:1;break;case 2:t=d.e('select[name="chbs_duration_service_type_2"]').val(),isNaN(t)&&(t=0),t*=60;break;case 3:t=d.e('select[name="chbs_extra_time_service_type_3"]').val(),isNaN(t)&&(t=0),t*=2===l.extra_time_unit?60:1}if(e.inArray(a,[1,3])>-1){d.e('select[name="chbs_transfer_type_service_type_'+a+'"]');t+=1*parseInt(d.e('input[name="chbs_duration_map"]').val(),10),i*=1}d.e('input[name="chbs_distance_sum"]').val(i),d.e('input[name="chbs_duration_sum"]').val(t);var o=d.splitTime(t);i=d.formatLength(i),d.e(".chbs-ride-info>div:eq(0)>span:eq(2)>span:eq(0)").html(i),d.e(".chbs-ride-info>div:eq(1)>span:eq(2)>span:eq(0)").html(o[0]),d.e(".chbs-ride-info>div:eq(1)>span:eq(2)>span:eq(2)").html(o[1]),d.calculateBaseLocationDistance(),d.googleMapCustomizeHeight()},this.formatLength=function(e){return 2===l.length_unit&&(e/=1.609344,e=Math.round(10*e)/10),e},this.splitTime=function(e){return[Math.floor(e/60),e%60]},this.createSummaryElement=function(){d.preloader(!0),d.setAction("create_summary_price_element"),d.post(e("body").find('form[name="chbs-form"]').serialize(),function(t){d.e(".chbs-summary, .chbs-summary-price-element").remove(),d.e(".chbs-layout-column-left").append(t.html),e(window).scroll(),d.preloader(!1)})},this.getGlobalNotice=function(){var e=parseInt(d.e('input[name="chbs_step"]').val(),10);return d.e(".chbs-main-content-step-"+e+" .chbs-notice")},this.calculateBaseLocationDistance=function(t,i){void 0===i&&(i=!1);var a,o,n=new CHBSHelper,s={distance:0,duration:0,return_distance:0,return_duration:0};if(!1===i){d.e('input[name="chbs_base_location_distance"]').val(0),d.e('input[name="chbs_base_location_duration"]').val(0),d.e('input[name="chbs_base_location_return_distance"]').val(0),d.e('input[name="chbs_base_location_return_duration"]').val(0),a={coordinate:{lat:l.base_location.coordinate.lat,lng:l.base_location.coordinate.lng}};var c=d.e('input[name="chbs_vehicle_id"]').val(),r=d.e('.chbs-vehicle-list .chbs-vehicle[data-id="'+c+'"]');1===r.length&&(n.isEmpty(r.attr("data-base_location_cooridnate_lat"))||n.isEmpty(r.attr("data-base_location_cooridnate_lng"))||(a.coordinate.lat=r.attr("data-base_location_cooridnate_lat"),a.coordinate.lng=r.attr("data-base_location_cooridnate_lng")))}else s.id=i.id,a={coordinate:{lat:i.lat,lng:i.lng}};if(n.isEmpty(a.coordinate.lat)||n.isEmpty(a.coordinate.lng))return d.callback(t,s),s;var p=d.getCoordinate(),h=new google.maps.DirectionsService;return 0===parseInt(p.length,10)?(d.callback(t,s),s):(o={origin:p[0],destination:new google.maps.LatLng(a.coordinate.lat,a.coordinate.lng),travelMode:google.maps.DirectionsTravelMode.DRIVING},h.route(o,function(n,c){if(c===google.maps.DirectionsStatus.OK){for(var r=0,l=0,_=0;_<n.routes[0].legs.length;_++)r+=n.routes[0].legs[_].distance.value,l+=n.routes[0].legs[_].duration.value;if(r/=1e3,r=Math.round(10*r)/10,l=Math.ceil(l/60),!1===i?(d.e('input[name="chbs_base_location_distance"]').val(r),d.e('input[name="chbs_base_location_duration"]').val(l)):(s.distance=r,s.duration=l),p.length>1){var u=1,g=d.getServiceTypeId();if(e.inArray(g,[1,3])>-1){var v=d.e('select[name="chbs_transfer_type_service_type_'+g+'"]');u=1===v.length?parseInt(v.val(),10):1}o={origin:e.inArray(u,[1,3])>-1?p[p.length-1]:p[0],destination:new google.maps.LatLng(a.coordinate.lat,a.coordinate.lng),travelMode:google.maps.DirectionsTravelMode.DRIVING},h.route(o,function(e,a){if(a===google.maps.DirectionsStatus.OK){for(var o=0,n=0,c=0;c<e.routes[0].legs.length;c++)o+=e.routes[0].legs[c].distance.value,n+=e.routes[0].legs[c].duration.value;o/=1e3,o=Math.round(10*o)/10,n=Math.ceil(n/60),!1===i?(d.e('input[name="chbs_base_location_return_distance"]').val(o),d.e('input[name="chbs_base_location_return_duration"]').val(n)):(s.return_distance=o,s.return_duration=n)}d.callback(t,s)})}else d.callback(t,s)}else d.callback(t,s)}),s)},this.removeDoubleQuote=function(e){return e.replace(/"/g,"")},this.callback=function(e,t){void 0!==e&&e(t)},this.createButtonRadio=function(t){d.e(t).on("click",".chbs-button-radio a",function(t){t.preventDefault();var i=e(this).parent(".chbs-button-radio").find('input[type="hidden"]');e(this).siblings("a").removeClass("chbs-state-selected"),e(this).hasClass("chbs-state-selected")?(i.val(-1),e(this).removeClass("chbs-state-selected")):(i.val(e(this).attr("data-value")),e(this).addClass("chbs-state-selected"))})}};e.fn.chauffeurBookingForm=function(e){return new a(this,e)}}(jQuery,document,window);